### Complete API Gateway Authentication Flow Test

### 1. Register a new BORROWER user
POST http://localhost:4000/auth/register
Content-Type: application/json

{
  "email": "test-borrower@example.com",
  "password": "password123",
  "role": "BORROWER",
  "fullName": "Test Borrower",
  "dateOfBirth": "1990-01-01"
}

###

### 2. Login to get JWT token (this will store the token in a variable)
POST http://localhost:4000/auth/login
Content-Type: application/json

{
  "email": "test-borrower@example.com",
  "password": "password123"
}

> {%
  client.global.set("token", response.body.token);
  client.log("Token stored: " + response.body.token);
%}

###

### 3. Test token validation directly (should return 200)
GET http://localhost:4005/validate/borrower
Authorization: Bearer {{token}}

###

### 4. Get all borrowers through API Gateway (main test)
GET http://localhost:4000/api/borrowers
Authorization: Bearer {{token}}

###

### 5. Test without token (should return 401)
GET http://localhost:4000/api/borrowers

###

### 6. Get specific borrower by ID
GET http://localhost:4000/api/borrowers/2
Authorization: Bearer {{token}}

###

### 7. Create a new borrower
POST http://localhost:4000/api/borrowers
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "firstName": "Jane",
  "lastName": "Smith",
  "email": "jane.smith@example.com",
  "phoneNumber": "+1987654321",
  "dateOfBirth": "1985-05-15",
  "ssn": "987-65-4321",
  "address": "456 Oak Avenue",
  "city": "Los Angeles",
  "state": "CA",
  "zipCode": "90210",
  "annualIncome": 85000.0,
  "employmentStatus": "EMPLOYED",
  "employerName": "Finance Corp",
  "employmentYears": 7
}

###

### 8. Test with existing user token (from auth service)
POST http://localhost:4000/auth/login
Content-Type: application/json

{
  "email": "debug-user@test.com",
  "password": "password123"
}

> {%
  client.global.set("existing_token", response.body.token);
%}

###

### 9. Get all borrowers with existing user token
GET http://localhost:4000/api/borrowers
Authorization: Bearer {{existing_token}}

###
